<button
    type="button"
    class="btn btn-default"
    data-ng-click="$ctrl.hideGameFirewall()"
>
    <i class="fa fa-chevron-left" aria-hidden="true"> </i>
    <span data-translate="common_back"></span>
</button>

<h4
    data-translate="ip_game_mitigation_title"
    data-translate-values="{ t0: $ctrl.datas.selectedIp }"
></h4>

<div data-ng-hide="$ctrl.loaders.firewall">
    <p
        data-ng-show="$ctrl.datas.firewall.state === $ctrl.constantes.OK"
        data-ng-bind-html="('ip_game_mitigation_firewall_'+ $ctrl.datas.firewall.firewallModeEnabled | translate)"
    ></p>
    <p
        data-ng-show="$ctrl.datas.firewall.state && $ctrl.datas.firewall.state !== $ctrl.constantes.OK"
        data-ng-bind-html="('ip_game_mitigation_firewall_'+ $ctrl.datas.firewall.state | translate)"
    ></p>
    <p
        class="text-danger"
        data-ng-hide="$ctrl.datas.firewall.state"
        data-ng-bind-html="'ip_game_mitigation_error' | translate"
    ></p>
</div>

<button
    type="button"
    class="btn btn-default"
    data-ng-click="$ctrl.goToRuleAdd({ 'ipBlock': $ctrl.datas.selectedBlock, 'ip': $ctrl.datas.selectedIp })"
>
    <span data-translate="ip_game_mitigation_rule_add"></span>
</button>

<button
    data-ng-if="!$ctrl.datas.firewall.firewallModeEnabled"
    type="button"
    class="btn btn-default"
    data-ng-disabled="$ctrl.datas.firewall.state !== $ctrl.constantes.OK"
    data-ng-click="$ctrl.goToToggle({ 'ipBlock': $ctrl.datas.selectedBlock, 'ip': $ctrl.datas.selectedIp, 'firewall': $ctrl.datas.firewall })"
>
    <span data-translate="ip_game_mitigation_firewall_enable_button"></span>
</button>

<button
    data-ng-if="$ctrl.datas.firewall.firewallModeEnabled"
    type="button"
    class="btn btn-default"
    data-ng-disabled="$ctrl.datas.firewall.state !== $ctrl.constantes.OK"
    data-ng-click="$ctrl.goToToggle({ 'ipBlock': $ctrl.datas.selectedBlock, 'ip': $ctrl.datas.selectedIp, 'firewall': $ctrl.datas.firewall })"
    data-translate="ip_game_mitigation_firewall_disable_button"
></button>

<div class="table-responsive mt-2">
    <table class="table table-hover">
        <thead>
            <tr>
                <th
                    scope="col"
                    data-translate="ip_game_mitigation_table_protocol"
                ></th>
                <th
                    scope="col"
                    data-translate="ip_game_mitigation_table_port"
                ></th>
                <th
                    scope="col"
                    data-translate="ip_game_mitigation_table_state"
                ></th>
                <th scope="col">
                    <button
                        type="button"
                        class="btn btn-link"
                        data-ng-click="$ctrl.refreshRules()"
                        title="{{:: 'common_refresh' | translate }}"
                    >
                        <i
                            class="fa fa-refresh"
                            aria-hidden="true"
                            aria-label="{{:: 'common_refresh' | translate }}"
                        >
                        </i>
                    </button>
                </th>
            </tr>
        </thead>
        <tbody
            data-ng-show="!$ctrl.loaders.rules && $ctrl.table.rules === null"
        >
            <tr>
                <td
                    colspan="4"
                    class="text-center"
                    data-translate="ip_game_mitigation_table_error"
                ></td>
            </tr>
        </tbody>
        <tbody
            data-ng-show="!$ctrl.loaders.rules && $ctrl.table.rules.length === 0"
        >
            <tr>
                <td
                    colspan="4"
                    class="text-center"
                    data-translate="ip_game_mitigation_table_empty"
                ></td>
            </tr>
        </tbody>
        <tbody data-ng-show="$ctrl.table.rules.length > 0">
            <tr data-ng-repeat="rule in $ctrl.table.rules | orderBy : '-id'">
                <th
                    scope="row"
                    data-ng-if="!rule.errorMessage"
                    data-ng-bind="rule.protocol"
                ></th>
                <td
                    data-ng-if="!rule.errorMessage"
                    data-ng-bind="rule.ports.from + (rule.ports.to && rule.ports.to !== rule.ports.from ? ' - ' + rule.ports.to : '')"
                ></td>
                <td
                    data-ng-if="!rule.errorMessage"
                    data-translate="{{ 'ip_game_mitigation_state_' + rule.state }}"
                ></td>
                <td data-ng-if="!rule.errorMessage">
                    <button
                        type="button"
                        class="btn btn-link"
                        title="{{:: 'common_delete' | translate }}"
                        data-ng-disabled="rule.state !== $ctrl.constantes.OK"
                        data-ng-click="$ctrl.goToRuleDelete({ 'ipBlock': $ctrl.datas.selectedBlock, 'ip': $ctrl.datas.selectedIp, 'rule': rule })"
                    >
                        <i
                            class="fa fa-trash"
                            aria-hidden="true"
                            aria-label="{{:: 'common_delete' | translate }}"
                        >
                        </i>
                    </button>
                </td>
                <td
                    colspan="4"
                    class="text-center text-danger"
                    data-ng-if="rule.errorMessage"
                    data-ng-bind="rule.errorMessage"
                ></td>
            </tr>
        </tbody>
        <tbody data-ng-show="$ctrl.loaders.rules">
            <tr>
                <td colspan="4" class="text-center">
                    <oui-spinner data-size="s"></oui-spinner>
                </td>
            </tr>
        </tbody>
    </table>
</div>
